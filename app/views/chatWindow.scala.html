@(appUser : models.AppUser, generalGroupId : Long)
@main("Welcome To Chat World"){

  <div class="mainchat clearfix">
    <div class="people-list" id="people-list">
      <div class="search">
        <input type="text" placeholder="search"/>
        <i class="fa fa-search"></i>
      </div>
      		<div class="panel-heading ">
				Channels &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span id="createGroup" style="cursor:pointer;">+</span>
			 </div>
		    <ul class="list">
		    <span class="groupMsgs">
		     @for(group <- appUser.getAppUserGroups){
		     	 <li class="clearfix clickSection @if(group.id.equals(generalGroupId)){active}" 
		     	 	msg-to-id="@group.id" msg-type="@utils.Constants.GROUP_MESSAGE" style="cursor:pointer;">
		          <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/chat_avatar_01.jpg" alt="avatar" />
		          <div class="about">
		          	@defining(models.MessageNotification.getGroupUnSeenMsgCount(appUser, group)){count=>
		            <div><span class="name">@group.name</span> <span class="badge">@count</span></div>
		          	}
		            <div class="status">
		              <i class="fa fa-circle online"></i> online
		            </div>
		          </div>
		        </li>
    	     }
    	     </span>
    	      <div class="panel-heading">
				Direct Messages
			 </div>
			 <span class="directMsgs">
		      @for(user <- AppUser.find.where().ne("id", appUser.id).findList()){
		        <li class="clearfix clickSection" msg-to-id="@user.id" 
		        style="cursor:pointer;" msg-type="@utils.Constants.DIRECT_MESSAGE">
		          <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/chat_avatar_01.jpg" alt="avatar" />
		          <div class="about">
		          @defining(models.MessageNotification.getPersonalUnSeenMsgCount(appUser, user)){count=>
		            <div><span class="name">@user.name </span><span class="badge">@count</span></div>
		            }
		            <div class="status">
		              <i class="fa fa-circle online"></i> online
		            </div>
		          </div>
		        </li>
		      }
		      </span>
	      	</ul>
    </div>
    
    <div class="chat">
      <div class="chat-header clearfix">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/chat_avatar_01_green.jpg" alt="avatar" />
        <div class="chat-about">
          <div class="chat-with">Chat with <span id="message-room-name">GENERAL</span></div>
          <div class="chat-num-messages">already 1 902 messages</div>
        </div>
        <i class="fa fa-star"></i>
      </div> <!-- end chat-header -->
      
      <div class="chat-history">
        <ul id="message-data">
	        @for(message <- models.Messages.getGroupMessages(appUser, GroupChannel.find.byId(generalGroupId))){
	        	@messageTemplate(message, message.sendBy.id.equals(appUser.id))	
	        }
        </ul>
      </div> <!-- end chat-history -->
      
      <div class="chat-message clearfix">
      	<input type="hidden" id="msgTypeVal" value="@utils.Constants.GROUP_MESSAGE">
   		<input type="hidden" id="msgById" value="@appUser.id">
   		<input type="hidden" id="msgToId" value="@generalGroupId">
        <textarea name="message-to-send" id="messageBox" placeholder ="Type your message" rows="3"></textarea>
        <i class="fa fa-file-o"></i> &nbsp;&nbsp;&nbsp;
        <i class="fa fa-file-image-o"></i>
        <button id="sendMessage" class="btn btn-info" >Send</button>
      </div> <!-- end chat-message -->
    </div> <!-- end chat -->
  </div> <!-- end container -->

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="exampleModalLabel">New message</h4>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="recipient-name" class="control-label">Recipient:</label>
            <input type="text" class="form-control" id="recipient-name">
          </div>
          <div class="form-group">
            <label for="message-text" class="control-label">Message:</label>
            <textarea class="form-control" id="message-text"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Send message</button>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" charset="utf-8" src="@routes.WebSocketController.loadChatWSJs(appUser.id)"></script>
<script>
$(document).on('click','.clickSection',function(e){
	
	var item = $(this);
	var name = item.find('.name').text();
	var msgType = item.attr('msg-type');
	var msgToId = item.attr('msg-to-id');
	var messageDataDiv = $('#message-data');
	//console.log(name+">>"+msgType+">>"+msgToId);
	
	item.find('.badge').html('0');
	$.get('/make-all-message-as-seen/'+msgType+"/"+msgToId,function(result){console.log(result);});
	
	$('#message-room-name').html(name);
	$('#msgTypeVal').val(msgType);
	$('#msgToId').val(msgToId);
	messageDataDiv.html('');
	$.get('/get-messages/'+msgType+"/"+msgToId,function(data){
		$.each(data, function(key, value){
			//console.log(key+">>"+value);
			messageDataDiv.append(value);

		});
		$('.clickSection').removeClass('active');
		item.addClass('active');
	});
});


</script>
}